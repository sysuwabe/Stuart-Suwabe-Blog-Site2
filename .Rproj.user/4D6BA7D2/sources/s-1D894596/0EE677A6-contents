---
title: "Untitled"
author: "Stuart Suwabe"
date: "6/15/2021"
output: html_document
---

```{r setup, include=FALSE}
library(readxl)
MMG2021_2019Data_ToShare <- read_excel("~/Downloads/Map the Meal Gap Data/MMG2021_2019Data_ToShare.xlsx")
foodin <- read_excel("~/Downloads/Map the Meal Gap Data/MMG2021_2019Data_ToShare.xlsx", sheet = "2019 County")
View(foodin)
```

```{r}
MMG2021_2019Data_ToShare$Definition
```

```{r pressure, echo=FALSE}
library(tidyverse)
foodin1 <- foodin %>%
  rename(county = `County, State`, insecure_percen = `2019 Food Insecurity Rate`, insecure_num = `# of Food Insecure Persons in 2019`, insecure_low_income = `% FI â‰¤ Low Threshold`, insecure_btwn_income = `% FI Btwn Thresholds`, insecure_high_income = `% FI > High Threshold`, insecure_child_percen = `2019 Child food insecurity rate`, insecure_child_num = `# of Food Insecure Children in 2019`, child_below_poverty_percen = `% food insecure children in HH w/ HH incomes below 185 FPL in 2019`, child_above_poverty_percen = `% food insecure children in HH w/ HH incomes above 185 FPL in 2019`, secure_meal_value = `2019 Cost Per Meal`) 
foodin2 <- foodin1[c(2,4,5,10:17)]
```

```{r}
# Explore the Data
ggplot(foodin2, aes(state, insecure_percen)) +
  stat_summary(geom = "bar", fun.y = "mean") + coord_flip()
# this is too messy... I need regions! 
```

```{r}
table(foodin2$state)

foodin2$state <- as.factor(foodin2$state)
state_pacific <- c("WA","OR","CA")
state_rocky <- c("MT","ID","WY","NV","UT","CO")
state_southwest <- c("AZ","NM","TX","OK")
state_midwest <- c("ND","SD","NE","MN","IA","WI","IL","OH","MI","IN","KS","MO")
state_southeast <- c("AR","LA","AL","TN","SC","NC","FL","VA","WV","DE","GA","KY","MS","MD")
state_northeast <- c("PA","NY","NJ","VT","ME","CT","NH","RI","MA")
state_other <- c("HI","AK","DC")
```

```{r}
foodin3 <- foodin2 %>%
  mutate(region = fct_collapse(state, "pacific" = state_pacific)) %>% mutate(region = fct_collapse(region, "rockies" = state_rocky)) %>% mutate(region = fct_collapse(region, "southwest" = state_southwest)) %>% mutate(region = fct_collapse(region, "midwest" = state_midwest)) %>% mutate(region = fct_collapse(region, "southeast" = state_southeast)) %>% mutate(region = fct_collapse(region, "northeast" = state_northeast)) %>%
  mutate(region = fct_collapse(region, "other" = state_other))
table(foodin3$region)
```

```{r}
ggplot(foodin3, aes(region, insecure_percen)) +
  stat_summary(geom = "bar", fun = "mean") + coord_flip()

# the top regions of the US with the most people suffering from food insecurity in 2019 are the Midwest, Southeast, and the "other" states (which includes Hawaii, Alaska, and the District of Columbia as it's own)
# the northeast surprisingly has the lowest percentage, with the rockies and the pacific regions not far behind
```







```{r}
ggplot(foodin3, aes(fct_reorder(state, insecure_percen), insecure_percen, fill = region)) +
  stat_summary(geom = "bar", fun = "mean") + coord_flip()
# The bars are ordered in decreasing fashion by total number of people suffering from food insecurity. 
## Notably Misissippi, Arkansas, Alabama, Lousiana, and Kentucky have the highest precentage of people with food insecurity, all in the Southeast region of the US
```
```{r}
aggregate(foodin3$insecure_percen, by = list(state = foodin3$state),FUN = mean)

```

```{r}
# I feel having the full population of each county (and thus each state) is important. 
foodin4 <- foodin3 %>%
  mutate(population = round(insecure_num / insecure_percen, digits = 0))
View(foodin4)
```

```{r}
ggplot(foodin4, aes(child_below_poverty_percen, region)) +
  stat_summary(geom = "bar", fun = "mean")
# Of the food insecure population, these are the children in said population who live in households with income below 185% of the federal poverty line, meaning that they (and the families they are in) are eligible for aids like Medicaid, CHIP, child nutrition programs like WIC and NSLP
## The Rockies and the Pacific region have the loweest percentage of these children in their food insecure population, as do Other (Alaska, Hawaii, DC). The Midwest, Northeast, and Southeast regions have the highest percentage. 
```

```{r}
ggplot(foodin4, aes(child_above_poverty_percen, region)) +
  stat_summary(geom = "bar", fun = "mean")
# Similarly, above the poverty percentage means they aren't eligible for such aid. 
```

```{r}
ggplot(foodin4, aes(insecure_num, population, color = region)) +
  geom_point() + xlim(0, 300000) + ylim(0,2500000) + facet_wrap(~region)
```

```{r}
ggplot(foodin4, aes(child_below_poverty_percen, insecure_child_num, color = region)) + geom_point() + ylim(0,100000) + facet_wrap(~region)
```


```{r}



```